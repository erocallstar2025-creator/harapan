<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>INTERROGATION: WITH CREDIT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@900&display=swap');

        body {
            background: #000;
            color: #fff;
            overflow: hidden;
            touch-action: none;
            font-family: 'Courier New', Courier, 'Noto Sans JP', sans-serif;
            -webkit-user-select: none;
        }

        .screen {
            display: none;
            position: absolute;
            inset: 0;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background: #000;
        }
        .screen.active { display: flex; animation: fade-in 0.3s ease-out; }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }

        .target-frame {
            position: relative;
            width: 90vw;
            height: 55vh;
            border: 1px solid #333;
            background: #050505;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .target-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            filter: grayscale(1) contrast(1.1) brightness(0.9);
        }

        .flash-layer {
            position: fixed;
            inset: 0;
            background: #fff;
            opacity: 0;
            pointer-events: none;
            z-index: 100;
        }
        .flash-active { animation: flash-white 0.2s ease-out; }
        @keyframes flash-white { 0% { opacity: 0.8; } 100% { opacity: 0; } }

        .impact-shake { animation: shake-vibe 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake-vibe {
            0% { transform: scale(1.1); filter: grayscale(1) invert(1); }
            20% { transform: translate(-15px, 15px); }
            40% { transform: translate(15px, -15px); }
            100% { transform: scale(1); filter: grayscale(1) invert(0); }
        }

        .btn-interrogation {
            width: 100%;
            max-width: 280px;
            padding: 1.2rem;
            border: 2px solid #fff;
            background: transparent;
            color: #fff;
            font-weight: 900;
            text-transform: uppercase;
            cursor: pointer;
        }
        .btn-interrogation:active { background: #fff; color: #000; }

        .credit-text {
            font-size: 10px;
            color: #666;
            margin-top: 8px;
            letter-spacing: 0.05em;
        }
    </style>
</head>
<body>

    <div id="flash" class="flash-layer"></div>

    <!-- START SCREEN -->
    <div id="screen-start" class="screen active">
        <div class="mb-8 text-center">
            <h1 class="text-5xl font-black italic tracking-tighter mb-2">尋問執行</h1>
            <p class="text-xs text-white font-bold tracking-widest mb-4">スマホを振って腹パンしよう</p>
            <p class="text-[10px] text-zinc-500 tracking-[0.3em]">CONFESS YOUR SINS</p>
        </div>
        <button onclick="requestPermission()" class="btn-interrogation">EXECUTE / 執行開始</button>
    </div>

    <!-- PLAY SCREEN -->
    <div id="screen-play" class="screen">
        <div class="absolute top-6 left-6 text-left">
            <div class="text-[9px] text-zinc-500">MAX_IMPACT</div>
            <div id="live-max" class="text-3xl font-black italic">0.0</div>
        </div>

        <div class="target-frame mb-6">
            <img id="main-img" src="" class="target-img" alt="Target">
            <div id="hit-label" class="absolute font-black text-6xl italic opacity-0 pointer-events-none text-white drop-shadow-2xl">IMPACT</div>
        </div>

        <div class="text-center mb-6">
            <div class="text-lg font-bold animate-pulse">SHAKE DEVICE NOW</div>
        </div>

        <button onclick="finishGame()" class="text-[10px] text-zinc-600 uppercase tracking-widest underline">尋問終了</button>
    </div>

    <!-- RESULT SCREEN -->
    <div id="screen-result" class="screen">
        <div class="mb-4 text-center">
            <h2 class="text-2xl font-black italic">供述調書</h2>
        </div>

        <div class="target-frame mb-4" style="height: 35vh;">
            <img id="result-img-display" src="" class="target-img" alt="Result">
        </div>

        <!-- クレジット表記 -->
        <div class="credit-text mb-4 text-center">
            キャラクター：およよちゃん　Made by みかっち
        </div>

        <div class="w-full max-w-xs space-y-2 mb-6 font-mono">
            <div class="flex justify-between border-b border-zinc-800 pb-1">
                <span class="text-[10px] text-zinc-500">MAX_G</span>
                <span class="text-lg font-bold"><span id="res-max">0.0</span> G</span>
            </div>
            <div class="flex justify-between border-b border-zinc-800 pb-1">
                <span class="text-[10px] text-zinc-500">PUNCHES</span>
                <span id="res-hits" class="text-lg font-bold">0</span>
            </div>
        </div>

        <button onclick="shareToX()" class="btn-interrogation bg-white text-black mb-4">REPORT TO X</button>
        <button onclick="location.reload()" class="text-[10px] text-zinc-600">RETRY</button>
    </div>

    <script>
        /**
         * ⚠️ 重要 ⚠️
         * 画像を表示するには、ここにBase64文字列を貼り付けてください。
         */
        const imgGameBase64 = "ゲーム中.png"; 
        const imgResultBase64 = "リザルト.png"; 

        let isRunning = false;
        let hits = 0;
        let maxPower = 0;
        let lastX = 0, lastY = 0, lastZ = 0;
        let lastPunchTime = 0;

        const mainImgEl = document.getElementById('main-img');
        const resImgEl = document.getElementById('result-img-display');

        // 初期設定
        mainImgEl.src = imgGameBase64;
        resImgEl.src = imgResultBase64;

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        async function requestPermission() {
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                try {
                    const res = await DeviceMotionEvent.requestPermission();
                    if(res === 'granted') startGame();
                    else alert("SENSOR ACCESS DENIED.");
                } catch(e) { startGame(); }
            } else { startGame(); }
        }

        function startGame() {
            hits = 0; maxPower = 0; isRunning = true;
            showScreen('screen-play');
            window.addEventListener('devicemotion', handleMotion, true);
        }

        function handleMotion(event) {
            if(!isRunning) return;
            const acc = event.accelerationIncludingGravity || event.acceleration;
            if(!acc || acc.x === null) return;

            const dx = acc.x - lastX;
            const dy = acc.y - lastY;
            const dz = acc.z - lastZ;
            const power = Math.sqrt(dx*dx + dy*dy + dz*dz);
            lastX = acc.x; lastY = acc.y; lastZ = acc.z;

            if(power > 5.0) triggerPunch(power);
        }

        function triggerPunch(power) {
            const now = Date.now();
            if(now - lastPunchTime < 350) return;
            lastPunchTime = now;

            hits++;
            if(power > maxPower) maxPower = power;
            document.getElementById('live-max').innerText = maxPower.toFixed(1);

            const flash = document.getElementById('flash');
            const label = document.getElementById('hit-label');

            mainImgEl.src = imgResultBase64;
            mainImgEl.classList.add('impact-shake');
            flash.classList.add('flash-active');
            label.style.opacity = "1";

            if(navigator.vibrate) navigator.vibrate(50);

            setTimeout(() => {
                mainImgEl.src = imgGameBase64;
                mainImgEl.classList.remove('impact-shake');
                flash.classList.remove('flash-active');
                label.style.opacity = "0";
            }, 300);
        }

        function finishGame() {
            isRunning = false;
            window.removeEventListener('devicemotion', handleMotion);
            document.getElementById('res-max').innerText = maxPower.toFixed(1);
            document.getElementById('res-hits').innerText = hits;
            showScreen('screen-result');
        }

        function shareToX() {
            const text = `【供述調書】尋問執行完了。\nキャラクター：およよちゃん Made by みかっち\n最大衝撃：${maxPower.toFixed(1)} G\n救済パンチ数：${hits} 回\n#救済のパンチグラップラー #尋問執行`;
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }
    </script>
</body>
</html>
